from pyspark.sql import SparkSession
from google.cloud import storage

spark = SparkSession.builder.appName("Spark XML").getOrCreate()

df = spark.read.csv("data.csv")

# Write to GCS  
output_file = "gs://bucket/output.xml.gz" 
df.coalesce(1).write.format("xml")\
         .option("compression", "gzip")\
         .save(output_file)

# Delete GCS _SUCCESS file
client = storage.Client() 
bucket = client.bucket("bucket")
blob = bucket.blob("_SUCCESS")
blob.delete()

spark.stop()
